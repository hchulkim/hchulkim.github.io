{
  "hash": "23c63f4f41e0d20deb7196c4e8b3bb62",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Personal Dockerfile for data science\"\ndescription: \"Personal Dockerfile template for my research workflow\"\ndate: \"2025-03-15\"\ntoc: false\nengine: knitr\ncategories:\n  - software\n---\n\n**Update: Recently I updated my Dockerfile for my research workflow. You can check it out [here](https://github.com/hchulkim/replication-template).**\n\nDuring spring break, I had some time to finalize the Dockerfile template for my research workflow. If you don't know what a Docker is, check it out [here](https://raw.githack.com/uo-ec607/lectures/master/13-docker/13-docker.html#1). TL;DR, it is a light virtual machine that contains all the necessary resources for your empirical analysis. It is as if you are shipping your computer to other people that wants to try out your analysis.\n\nIf you want the exact replication project folder, click [here](https://github.com/hchulkim/replication-template).\n\nThis is the final `Dockerfile` (for now):\n\n\n::: {.cell}\n\n```{.bash .cell-code}\n# Use Rocker image as the base for R\nFROM rocker/r-ver:4.4.0\n\nLABEL maintainer=\"Hyoungchul Kim <hchul.kim96@gmail.com>\"\n\n## Update and install system dependencies\nRUN apt-get update && apt-get install -y \\\n    libcurl4-openssl-dev \\\n    libssl-dev \\\n    libfontconfig1-dev \\\n    libharfbuzz-dev \\\n    libfribidi-dev \\\n    libfreetype6-dev \\\n    libpng-dev \\\n    libtiff5-dev \\\n    libjpeg-dev \\\n    libglpk-dev \\\n    libxml2-dev \\\n    libcairo2-dev \\\n    libgit2-dev \\\n    libpq-dev \\\n    libsasl2-dev \\\n    libsqlite3-dev \\\n    libssh2-1-dev \\\n    libxt-dev \\\n    libgdal-dev \\\n    wget \\\n    curl \\\n    vim \\\n    git\t\n\n## Install Pandoc and Quarto (Required for RMarkdown, Quarto, etc.)\n# RUN /rocker_scripts/install_pandoc.sh\n# RUN /rocker_scripts/install_quarto.sh\n\n## Install Python & Poetry\nRUN /rocker_scripts/install_python.sh && \\\n    pip3 install --upgrade pip && \\\n    pip3 install poetry\n\n# Ensure Poetry installs dependencies in the system environment\nRUN poetry config virtualenvs.create false\n\n# Copy Poetry files and install dependencies\nCOPY pyproject.toml poetry.lock .\nRUN poetry install --no-interaction --no-root\n\n## Install Julia 1.11.3 (to match Manifest.toml)\nENV JULIA_VERSION=1.11.3\nRUN /rocker_scripts/install_julia.sh\n\n## Set working directory\nWORKDIR /project\n\n## Copy renv.lock file into the folder\nCOPY renv.lock .\n\n# Set environment variables for renv\nENV RENV_VERSION=1.0.7\nENV RENV_PATHS_CACHE=/renv/cache\nENV RENV_CONFIG_REPOS_OVERRIDE=https://cloud.r-project.org\nENV RENV_CONFIG_AUTOLOADER_ENABLED=FALSE\nENV RENV_WATCHDOG_ENABLED=FALSE\nRUN echo \"options(renv.consent = TRUE)\" >> .Rprofile\nRUN echo \"options(RETICULATE_MINICONDA_ENABLED = FALSE)\" >> .Rprofile\n\n# Install renv from CRAN (avoiding bootstrapping by specifying version)\nRUN R -e \"install.packages('renv', repos = c(CRAN = 'https://cloud.r-project.org'))\"\nRUN R -e \"renv::consent(provided = TRUE)\"\n\n# Run renv restore to restore the environment\nRUN R -e \"renv::restore(confirm = FALSE)\"\n\n# Install Julia packages and manage dependencies\nCOPY Manifest.toml Project.toml .\nENV JULIA_PROJECT=/project\nRUN julia -e \"import Pkg; Pkg.activate(\\\".\\\"); Pkg.instantiate()\"\n\n# Copy over the rest of the project files\nCOPY . .\n\n# Default command\nCMD [\"bash\"]\n\n```\n:::\n\n\nAlthough most of the commands are self-explanatory from the comments, here is some additional info on what my Dockerfile does:\n\n1. In my personal Dockerfile, I have added three major programming languages that I use: `R`, `Python`, and `Julia`.\n\n2. I have also added some necessary dependencies and useful programs (e.g. `git`, `vim`) for my analysis.\n\n3. I have also added dependency management software for all of the languages. `renv` for `R`, `poetry` for `Python`, and `Pkg` environment for `Julia`. This allows you to use the exact versions of the packages that you installed in your analysis.\n\n4. For this code to fully work, you would need to setup some files (e.g. `Project.toml`, `Manifest.toml`, etc).\n\n5. Save the above code as `Dockerfile` (no extensions) right inside your project directory.\n\n### Quick terminology\n\n- Dockerfile: \"The sheet music.\" The list of layers and instructions for building a Docker image.\n\n- Image: \"The MP3 file.\" This is the tarball.\n\n- Container: \"Song playing on my phone.\" A container is a running instance of an image.\n\n### Docker workflow\n\n1. Create Dockerfile.\n\n2. Build Docker image using Dockerfile.\n\n\n::: {.cell}\n\n```{.bash .cell-code}\n# IMPORTANT: If this does not go through, maybe try sudo command\ndocker build --network=host --tag <PROJECT_NAME>:VERSION . \n\n# Above command might not work well in computers such as Macbook with Apple Silicon (Ofc...). This is mainly because it has a different cpu architecture (arm64 instead of amd64) so the base image is different. I am not sure if this is the best solution but try this code below.\n# docker build --platform=linux/amd64 --tag <PROJECT_NAME>:VERSION .\n```\n:::\n\n\n3. Run Docker image.\n\n\n::: {.cell}\n\n```{.bash .cell-code}\ndocker run -it --rm <PROJECT_NAME>:VERSION\n```\n:::\n\n\n### Some useful Docker-related commands\n\n\n::: {.cell}\n\n```{.bash .cell-code}\n# check cached docker images\ndocker images\n\n# check docker containers that are running\ndocker ps\n\n# remove the docker image\ndocker rmi <IMAGE_NAME>\n\n# remove all dangling images and caches (do it periodically to save space)\ndocker system prune\n```\n:::\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}